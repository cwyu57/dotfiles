#! /bin/bash
set -euo pipefail

echo "ğŸš€ Running initial setup..."

# {{ if eq .chezmoi.os "darwin" }}

# Install Homebrew if not installed
if ! command -v brew &> /dev/null; then
    echo "ğŸº Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install all dependencies with Brew Bundle
echo "Installing packages from Brewfile..."
brew bundle --file={{ .chezmoi.sourceDir }}/Brewfile

# Install zimfw (Zim Framework for Zsh)
echo "ğŸ”¹ Setting up zimfw..."
if [ -d "$HOME/.zim" ]; then
    echo "zimfw already installed, skipping installation."
else
    echo "Installing zimfw..."
    curl -fsSL https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh
fi


# Set up macOS defaults
echo "ğŸ’» Setting up macOS defaults..."

# Disable press-and-hold for keys in favor of key repeat
defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

# Set a faster keyboard repeat rate
defaults write NSGlobalDomain KeyRepeat -int 2
defaults write NSGlobalDomain InitialKeyRepeat -int 15

{{ else if eq .chezmoi.os "linux" }}
echo "ğŸš§ Setting up Linux system... (Not implemented yet)"

{{ end }}

echo "âœ… Setup complete! Please log out and back in for all changes to take effect."
